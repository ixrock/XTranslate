/*! For license information please see content.bundle.js.LICENSE.txt */
(()=>{"use strict";class e{constructor(){this.key="NO_QUERY_SEARCH_TEXT_KEY"}}const t=class{constructor(e){this.config=e}getQuerySearchText(){for(const e of this.config.queryKeywordKeys){const t=new URLSearchParams(window.location.search).get(e);if(t)return t}throw new e(window.location.href)}getQueryPage(){for(const e of this.config.queryPageKeys){const t=new URLSearchParams(window.location.search).get(e);if(t)return t}}};class n{constructor(){this.key="NO_SEARCH_INPUT"}}class s{constructor(){this.key="NO_SEARCH_BLOCK"}}class o{constructor(){this.key="NO_LINK_BLOCKS"}}class r{constructor(){this.key="NO_LINKS"}}class c{constructor(){this.key="NO_POSITIONING_PIVOTS"}}class i{constructor(){this.key="PARSING_EXCEPTION"}}const a=class{constructor(e){this.config=e}getDOMElements(){const{searchBlockPatterns:e}=this.config;let t=null,n=null;for(const s of e)if(t=window.document.querySelector(s),t&&(n=this.getLinkBlocks(t),this.isAllNecessaryElementsFound(n)))return{searchBlock:{pattern:s,element:t},linkBlocks:n};this.throwException(t,n)}getLinkBlocks(e){const{linkBlockPatterns:t}=this.config;for(const n of t){const t=e.querySelectorAll(n);if(t.length)return t.forEach((e=>{e.link=this.getLink(e),e.pivotElement=this.getPositioningPivot(e)})),{pattern:n,elements:t}}}getLink(e){const{linkPatterns:t}=this.config;for(const n of t){const t=e.querySelector(n);if(t&&"A"===t.tagName)return{pattern:n,element:t}}}getPositioningPivot(e){const{before:t=null,after:n=null}=this.config.positioning,s=t||n;for(const t of s){const n=e.querySelector(t);if(n)return{pattern:t,element:n}}}isAllNecessaryElementsFound(e){return e&&e.elements[0].link&&!!e.elements[0].pivotElement}getSearchInputText(){for(const e of this.config.searchInputPatterns){const t=window.document.querySelector(e);if(t&&t.value)return t.value}throw new n}throwException(e,t){switch(!0){case!e:throw new s;case!t||!t.elements.length:throw new o;case!t.elements[0].link:throw new r;case!t.elements[0].pivotElement:throw new c;default:throw new i}}};const l=class{constructor(e){this.config=e}collectAllChildElementsParams(e){const{logTagNamesToExclude:t}=this.config,n=e.childNodes,s=[];return n.forEach((e=>{if(!e.tagName||t.includes(e.tagName.toLowerCase()))return;const{tagName:n,id:o,className:r,href:c}=e,i={tagName:n,id:o,className:r,childElementsParams:this.collectAllChildElementsParams(e)};c&&(i.href=c),s.push(i)})),s}};const h=class{static parseHref(e,t){const n=new RegExp(t),s=e.match(n);return s?s[1]:e}static decodeHref(e,t){for(let n=0;n<t;n++)e=decodeURIComponent(e);return e}};const f=class{constructor(e){this.config=e}parseLinks(e){const{decodeNumberTimes:t,specificParseRule:n,hrefRegex:s}=this.config,o=[];return e.forEach((e=>{const{link:r}=e;if(!r)return;const c=h.decodeHref(r.element.href,t);o.push(n?h.parseHref(c,s):c)})),o}},u="universalSearchStart",m="universalSearchCheckLinks",g="universalSearchData",d="universalSearchApproveNewConfig",p="universalSearchException",k="universalSearchContextMenuNewTab";const E=class{constructor(e,t){this.config=e,this.searchElements=t}applyChanges(e){const{specificParseRule:t,hrefRegex:n}=this.config,{linkBlocks:s}=this.searchElements;s.elements.forEach((s=>{if(!s.link)return;const{element:o}=s.link;o&&e.forEach((e=>{const r=t?h.parseHref(o.href,n):o.href;e.url===r&&(this.replaceLink(o,e),this.insertLogoIn(s,this.createLinkBlock(e.logoBlock)))}))}))}replaceLink(e,t){const n=e.cloneNode(!0),s=this.addLinkEventListeners(n,t.transformedHref);e.parentNode.replaceChild(s,e)}addLinkEventListeners(e,t){let n="";return e.addEventListener("mouseover",(function(){n=n||this.href,this.href=n})),e.addEventListener("mouseup",(function(){this.href=t})),e.addEventListener("contextmenu",(function(){chrome.runtime.sendMessage({message:k,payload:{transformedHref:t,originalHref:this.href}})})),e}createLinkBlock({linkProps:e,imageProps:t}){const{parentBlock:n,link:s,img:o}=this.config.newElementsParams,r=Object.assign(document.createElement("div"),n),c=Object.assign(document.createElement("a"),s,e),i=Object.assign(document.createElement("img"),o,t);return c.appendChild(i),r.appendChild(this.addLinkEventListeners(c,e.transformedHref)),r}insertLogoIn(e,t){const{before:n=null}=this.config.positioning,{element:s}=e.pivotElement,o=n?s:s.nextSibling;s.parentNode.insertBefore(t,o)}},w={},y={origin:location.origin,hostname:location.hostname,pathname:location.pathname,href:location.pathname};chrome.runtime.sendMessage({message:u,payload:{location:y}}),chrome.runtime.onMessage.addListener((async e=>{if(e.message!==g)return;const{payload:n={}}=e;if(n.config){try{!function(e){w.config=e;const n=new t(e),s=new a(e),o=n.getQuerySearchText(),r=s.getSearchInputText();w.searchElements={searchText:e.isInputKeywordFirst?r:o,pageNumber:n.getQueryPage(),...s.getDOMElements()}}(n.config)}catch(e){return void function({key:e}){const t=new l(w.config).collectAllChildElementsParams(document.body);chrome.runtime.sendMessage({message:p,payload:{location:y,key:e,logValue:t}})}(e)}!function(){const{config:e,searchElements:t}=w,{linkBlocks:n,searchText:s,pageNumber:o}=t,r=new f(e).parseLinks(n.elements);chrome.runtime.sendMessage({message:m,payload:{location:y,searchText:s,pageNumber:o,parsedLinks:r}})}()}n.transformedLinks&&(!function(e){const{config:t,searchElements:n}=w;new E(t,n).applyChanges(e)}(n.transformedLinks),w.config.isConfigNew&&chrome.runtime.sendMessage({message:d}))}))})();